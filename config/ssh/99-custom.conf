# SSH Security Configuration
# Managed by Ansible - Do not modify directly
# Based on Mozilla Modern SSH hardening guidelines

# Authentication
PasswordAuthentication no
ChallengeResponseAuthentication no
PubkeyAuthentication yes
AuthenticationMethods publickey
PermitRootLogin prohibit-password
PermitEmptyPasswords no
MaxAuthTries 3
MaxSessions 10

# Security hardening
Protocol 2
StrictModes yes
IgnoreRhosts yes
HostbasedAuthentication no
PermitUserEnvironment no
AllowAgentForwarding no
AllowTcpForwarding no
X11Forwarding no
PrintMotd no
PrintLastLog yes
TCPKeepAlive yes
Compression delayed
UsePAM yes
UseDNS no

# Crypto hardening (Mozilla Modern)
KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com

# Host key algorithms
HostKeyAlgorithms ssh-ed25519,ssh-ed25519-cert-v01@openssh.com,rsa-sha2-512,rsa-sha2-256

# Idle timeout
ClientAliveInterval 300
ClientAliveCountMax 2

# Logging
SyslogFacility AUTH
LogLevel VERBOSE

# Banner
Banner /etc/ssh/banner.txt

# Restrict access (uncomment and modify as needed)
# AllowUsers ansible deploy
# AllowGroups ssh-users sudo
# DenyUsers root
# DenyGroups nogroup

# Rate limiting
MaxStartups 10:30:60
LoginGraceTime 60

# Subsystems
Subsystem sftp /usr/lib/openssh/sftp-server -f AUTHPRIV -l INFO

# Match rules for specific users/groups
# Example: Allow SFTP only for certain users
# Match Group sftp-only
#     ForceCommand internal-sftp
#     ChrootDirectory /var/sftp/%u
#     AllowTcpForwarding no
#     X11Forwarding no

# SSH Security Hardening Configuration for Debian/Ubuntu
# Place in /etc/ssh/sshd_config.d/

# Authentication
PasswordAuthentication no
PermitRootLogin prohibit-password
PubkeyAuthentication yes
ChallengeResponseAuthentication no
PermitEmptyPasswords no
UsePAM yes

# Limit authentication attempts and sessions
MaxAuthTries 3
MaxSessions 5
MaxStartups 10:30:100

# Security settings
StrictModes yes
IgnoreRhosts yes
HostbasedAuthentication no
PermitUserEnvironment no

# Login grace time (2 minutes)
LoginGraceTime 120

# Disable potentially dangerous features
X11Forwarding no
AllowTcpForwarding no
AllowStreamLocalForwarding no
GatewayPorts no
PermitTunnel no

# Use strong ciphers and algorithms only
Ciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256
KexAlgorithms secdh-sha2-nistp521,secdh-sha2-nistp384,secdh-sha2-nistp256,diffie-hellman-group-exchange-sha256

# Logging
SyslogFacility AUTH
LogLevel INFO

# Client alive settings (disconnect idle clients)
ClientAliveInterval 300
ClientAliveCountMax 2

# Banner
Banner /etc/ssh/banner.txt

# Debian specific - accept locale environment variables
AcceptEnv LANG LC_*

# SFTP configuration
Subsystem sftp /usr/lib/openssh/sftp-server
